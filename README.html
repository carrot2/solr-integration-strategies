<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Apache SOLR and Carrot<sup>2</sup> integration strategies</title>

    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <link href="assets/css/prettify.css" rel="stylesheet" />
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="span12">
          <div class="page-header">
            <h1>Apache SOLR and Carrot<sup>2</sup> integration strategies</h1>
          </div>

          <p>Adding clustering of search results to Apache Solr can be done in several ways,
          depending on where the clustering takes place, which fields are picked for clustering
          and how they are transformed before they are clustered. This document discusses
          several of these strategies.</p>

          <h2>Preparations</h2>

          <p>The following github repository contains code samples
          and configurations used in the remaining part of this document.</p>
          <pre>
            git clone https://github.com/carrot2/solr-integration-strategies.git
          </pre>

          <p>A local copy of Solr 4.2 will be required.</p>
          <pre>
            cd solr-integration-strategies
            cd solr-configs
            wget -c -t0 -T30 http://www.us.apache.org/dist/lucene/solr/4.2.0/solr-4.2.0.tgz
            tar -zxf solr-4.2.0.tgz
          </pre>

          <p>The project contains an example Solr configuration (including data schema)
            and some sample documents from the 20-newsgroups collection. The following command starts
            Solr and imports these documents. Should be executed from another shell session
            since it won't return to shell.</p>

          <pre>
            cd solr-4.*
            cd example
            java -Dsolr.solr.home=../../solr-home -jar start.jar
          </pre>

          <p>Once started, the search core should be visible in the administrative panel at
          <a href="http://localhost:8983/solr/#/example" target="_blank">http://localhost:8983/solr/#/example</a>.</p>

          <p>To import example documents execute the following commands:</p>

          <pre>
            cd solr-docs
            java -jar post.jar 20newsgroups
          </pre>

          <h2>An overview of Solr and Carrot<sup>2</sup> configurations</h2>

          <p>There are several axes which diversify the configuration of Solr and
            Carrot<sup>2</sup>:</p>
          <ul>
            <li>Where does clustering take place (inside Solr or outside Solr)?</li>
            <li>What data is fed into the clustering process (entire contents of stored fields, query-in-context snippets)?</li>
            <li>Are users experimenting with clustering parameters or is clustering preset on the server for all users?
              For example the
              <a href="http://download.carrot2.org/head/manual/index.html#section.webapp">web application front-end</a> to clustered search results
              will be shared by all users, whereas users of
              <a href="http://download.carrot2.org/head/manual/index.html#section.workbench">Carrot<sup>2</sup> Workbench</a> will need
              a raw stream of search results which is then clustered on their machine.</li>
          </ul>

          <p>All examples in this chapter assume a certain fixed choice in the above set of configuration
          options. Pick the one closest to your own.</p>

          <h3>Clustering of entire fields inside Solr</h3>
          <!--
           how to map fields to title/snippet/url?
           configuring Carrot2 webapp/Workbench to display clusters produced inside Solr
          -->

          <h3>Clustering of query-in-context fragments inside Solr</h3>
          <!--
           how to configure which fields are highlighted, parameters, etc?
           configuring Carrot2 webapp/Workbench to display clusters produced inside Solr
          -->

          <h3>Clustering of entire fields outside Solr</h3>
          <!--
           custom field mapping via XSLT
          -->

          <h3>Clustering of query-in-context fragments outside Solr</h3>
          <!--
           a configuration which limits the amount of data passed to clustering (no full fields).
          -->
        </div>
      </div>
    </div>

    <script src="assets/js/prettify.js"></script>
    <script src="assets/js/jquery-1.8.2.min.js"></script>
    <script>
      (function() {
        function trimIndent(ms) {
          var lines = ms.split(/[\r\n]+/);

          // calculate common indent.
          var maxIndent = Number.MAX_VALUE;
          for (var i = 0; i < lines.length; i++) {
            var line = lines[i];
            if (line.trim().length > 0) {
              var prefix = /^[ ]+/.exec(line);
              if (prefix) {
                maxIndent = Math.min(maxIndent, prefix[0].length);
              }
            }
          }

          var reindented = [];
          for (var i = 0; i < lines.length; i++) {
            var line = lines[i];
            if (line.trim().length > 0) {
              line = line.substring(maxIndent);
            }
            reindented.push(line);
          }

          while (reindented.length > 0 && reindented[0].trim().length == 0) { reindented.shift(); }
          while (reindented.length > 0 && reindented[reindented.length - 1].trim().length == 0) { reindented.pop(); }

          return reindented.join("\n");
        }

        $("pre").each(function(i,e) {
          e = $(e);
          e.text(trimIndent(e.text()));
          e.addClass("prettyprint");
        });
      })();
    </script>
  </body>
</html>
